import {EditorView, WidgetType} from "@codemirror/view";

export class HighlightWidget extends WidgetType {
	innerText: string;
	syncCallback: () => void;
	mark: HTMLElement;
	markClass: string;

	constructor(innerText: string, syncCallback: () => void, firstLoad: boolean) {
		super();
		this.innerText = innerText;
		this.syncCallback = syncCallback;
		this.mark = document.createElement("span");
		this.markClass = "highlighted-text-static";
		if(firstLoad) this.markClass = "highlighted-text-dynamic";
	}

	toDOM(view: EditorView): HTMLElement {
		this.mark.addClass(this.markClass);
		this.mark.innerText = this.innerText;
		this.mark.id = "highlighted-text";
		const tooltip = this.mark.createEl("span");
		tooltip.addClass("tooltip");
		const button = tooltip.createEl("button")
		button.addClass("icon-button");
		button.innerHTML = button.innerHTML = "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" version=\"1.1\" width=\"100%\" style=\"shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd\" xml:space=\"preserve\" >\n" +
			"<g><path style=\"opacity:0.973\" fill=\"#010101\" d=\"M 108.5,40.5 C 111.355,43.5919 112.188,47.2586 111,51.5C 109.786,53.0488 108.286,54.2155 106.5,55C 88.5,55.3333 70.5,55.6667 52.5,56C 33.8471,60.6533 21.6804,72.1533 16,90.5C 14.3446,171.79 14.0113,253.123 15,334.5C 19.0307,358.198 32.864,372.364 56.5,377C 98.5,377.333 140.5,377.667 182.5,378C 188.43,379.922 193.263,383.422 197,388.5C 212.333,409.167 227.667,429.833 243,450.5C 251.304,457.111 259.637,457.111 268,450.5C 283.333,429.833 298.667,409.167 314,388.5C 317.737,383.422 322.57,379.922 328.5,378C 341.167,377.333 353.833,377.333 366.5,378C 369.217,379.259 370.55,381.426 370.5,384.5C 370.218,387.731 368.885,390.398 366.5,392.5C 354.424,392.062 342.424,392.562 330.5,394C 312.833,417 295.167,440 277.5,463C 261.318,474.932 245.818,474.099 231,460.5C 214.774,437.884 197.94,415.718 180.5,394C 138.226,392.683 95.8925,392.016 53.5,392C 24.5161,386.18 6.51609,369.013 -0.5,340.5C -0.5,257.5 -0.5,174.5 -0.5,91.5C 6.66511,62.5041 24.9984,45.3374 54.5,40C 72.5736,39.1812 90.5736,39.3479 108.5,40.5 Z\"/></g>\n" +
			"<g><path style=\"opacity:0.974\" fill=\"#040404\" d=\"M 511.5,91.5 C 511.5,174.5 511.5,257.5 511.5,340.5C 504.484,369.013 486.484,386.18 457.5,392C 435.094,392.822 412.761,392.655 390.5,391.5C 386.196,386.534 386.529,382.034 391.5,378C 412.5,377.667 433.5,377.333 454.5,377C 478.136,372.364 491.969,358.198 496,334.5C 496.667,254.5 496.667,174.5 496,94.5C 491.233,74.1318 478.733,61.2985 458.5,56C 351.167,55.6667 243.833,55.3333 136.5,55C 131.776,52.5647 130.276,48.7314 132,43.5C 133.045,42.6266 133.878,41.6266 134.5,40.5C 241.764,39.3357 349.097,39.1691 456.5,40C 486.002,45.3374 504.335,62.5041 511.5,91.5 Z\"/></g>\n" +
			"<g><path style=\"opacity:1\" fill=\"#eeeeee\" d=\"M 108.5,40.5 C 117.167,40.5 125.833,40.5 134.5,40.5C 133.878,41.6266 133.045,42.6266 132,43.5C 130.276,48.7314 131.776,52.5647 136.5,55C 243.833,55.3333 351.167,55.6667 458.5,56C 478.733,61.2985 491.233,74.1318 496,94.5C 496.667,174.5 496.667,254.5 496,334.5C 491.969,358.198 478.136,372.364 454.5,377C 433.5,377.333 412.5,377.667 391.5,378C 386.529,382.034 386.196,386.534 390.5,391.5C 382.445,391.23 374.445,391.563 366.5,392.5C 368.885,390.398 370.218,387.731 370.5,384.5C 370.55,381.426 369.217,379.259 366.5,378C 353.833,377.333 341.167,377.333 328.5,378C 322.57,379.922 317.737,383.422 314,388.5C 298.667,409.167 283.333,429.833 268,450.5C 259.637,457.111 251.304,457.111 243,450.5C 227.667,429.833 212.333,409.167 197,388.5C 193.263,383.422 188.43,379.922 182.5,378C 140.5,377.667 98.5,377.333 56.5,377C 32.864,372.364 19.0307,358.198 15,334.5C 14.0113,253.123 14.3446,171.79 16,90.5C 21.6804,72.1533 33.8471,60.6533 52.5,56C 70.5,55.6667 88.5,55.3333 106.5,55C 108.286,54.2155 109.786,53.0488 111,51.5C 112.188,47.2586 111.355,43.5919 108.5,40.5 Z\"/></g>\n" +
			"<g><path style=\"opacity:1\" fill=\"#040404\" d=\"M 238.5,101.5 C 288.974,97.3091 325.474,117.642 348,162.5C 349.806,167.418 351.306,172.418 352.5,177.5C 382.402,186.128 398.735,205.961 401.5,237C 399.953,274.105 380.953,296.105 344.5,303C 329.837,303.5 315.17,303.667 300.5,303.5C 300.5,297.5 300.5,291.5 300.5,285.5C 314.504,285.667 328.504,285.5 342.5,285C 367.772,280.059 381.439,264.725 383.5,239C 380.983,213.817 367.316,198.817 342.5,194C 340.998,193.417 339.665,192.584 338.5,191.5C 325.278,142.392 293.278,118.892 242.5,121C 205.825,129.01 182.991,151.177 174,187.5C 173.458,194.605 172.458,201.605 171,208.5C 169.421,210.041 167.587,211.208 165.5,212C 148.373,212.146 136.206,219.979 129,235.5C 123.125,260.923 132.625,277.423 157.5,285C 174.83,285.5 192.163,285.667 209.5,285.5C 209.5,291.5 209.5,297.5 209.5,303.5C 190.83,303.667 172.164,303.5 153.5,303C 121.853,293.677 107.02,272.51 109,239.5C 114.76,214.906 129.927,199.906 154.5,194.5C 161.51,144.492 189.51,113.492 238.5,101.5 Z\"/></g>\n" +
			"<g><path style=\"opacity:1\" fill=\"#020202\" d=\"M 246.5,330.5 C 246.833,301.492 246.5,272.492 245.5,243.5C 244.893,243.624 244.56,243.957 244.5,244.5C 238.447,251.252 231.947,257.586 225,263.5C 220.495,259.661 216.328,255.495 212.5,251C 224.833,238.667 237.167,226.333 249.5,214C 252.702,212.517 256.036,212.183 259.5,213C 272.293,225.627 284.96,238.46 297.5,251.5C 293.833,255.833 289.833,259.833 285.5,263.5C 278.514,257.015 271.681,250.348 265,243.5C 264.5,272.498 264.333,301.498 264.5,330.5C 258.5,330.5 252.5,330.5 246.5,330.5 Z\"/></g>\n" +
			"<g><path style=\"opacity:1\" fill=\"#7e7e7e\" d=\"M 244.5,244.5 C 244.56,243.957 244.893,243.624 245.5,243.5C 246.5,272.492 246.833,301.492 246.5,330.5C 245.833,301.833 245.167,273.167 244.5,244.5 Z\"/></g>\n" +
			"</svg>"
		button.onClickEvent((mouseEvent) => {
			this.syncCallback.call(this);
		})
		return this.mark;

	}
}
